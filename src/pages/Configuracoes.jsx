import React, { useState } from 'react'
import Input from '../components/Input'
import Botao from '../components/Botao'
import Alerta from '../components/Alerta'
import api from '../services/api'
export default function Configuracoes(){ const [nome,setNome]=useState(''); const [email,setEmail]=useState(''); const [mensagem,setMensagem]=useState(''); const [erro,setErro]=useState(''); const [carregando,setCarregando]=useState(false); const [senhaAtual,setSenhaAtual]=useState(''); const [novaSenha,setNovaSenha]=useState(''); const [confirmar,setConfirmar]=useState(''); const [carregandoSenha,setCarregandoSenha]=useState(false); async function salvarPerfil(e){ e.preventDefault(); setErro(''); setMensagem(''); try{ setCarregando(true); await api.instancia.put('/usuarios/perfil',{ nome,email }); setMensagem('Dados atualizados com sucesso!'); }catch(ex){ setErro(ex?.response?.data?.mensagem || 'Falha ao atualizar dados.'); } finally{ setCarregando(false);} } async function alterarSenha(e){ e.preventDefault(); setErro(''); setMensagem(''); if(novaSenha!==confirmar) return setErro('A confirmação de senha não confere.'); try{ setCarregandoSenha(true); await api.instancia.put('/usuarios/senha',{ senha_atual:senhaAtual, nova_senha:novaSenha }); setMensagem('Senha alterada com sucesso!'); setSenhaAtual(''); setNovaSenha(''); setConfirmar(''); }catch(ex){ setErro(ex?.response?.data?.mensagem || 'Falha ao alterar senha.'); } finally{ setCarregandoSenha(false);} } return <div className="space-y-6"><h1 className="titulo-secao">Configurações</h1>{mensagem && <Alerta tipo="sucesso" mensagem={mensagem} />}{erro && <Alerta tipo="erro" mensagem={erro} />}<div className="grid grid-cols-1 md:grid-cols-2 gap-4"><form onSubmit={salvarPerfil} className="card p-4 space-y-3"><h2 className="font-semibold">Perfil</h2><Input rotulo="Nome" valor={nome} onChange={e=>setNome(e.target.value)} placeholder="Seu nome" /><Input rotulo="E-mail" valor={email} onChange={e=>setEmail(e.target.value)} placeholder="seu@email" tipo="email" /><div><Botao type="submit" carregando={carregando}>Salvar</Botao></div></form><form onSubmit={alterarSenha} className="card p-4 space-y-3"><h2 className="font-semibold">Alterar senha</h2><Input rotulo="Senha atual" tipo="password" valor={senhaAtual} onChange={e=>setSenhaAtual(e.target.value)} /><Input rotulo="Nova senha" tipo="password" valor={novaSenha} onChange={e=>setNovaSenha(e.target.value)} /><Input rotulo="Confirmar nova senha" tipo="password" valor={confirmar} onChange={e=>setConfirmar(e.target.value)} /><div><Botao type="submit" carregando={carregandoSenha}>Alterar</Botao></div></form></div></div> }

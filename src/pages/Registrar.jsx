import React, { useState } from 'react'
import { useNavigate, Link } from 'react-router-dom'
import Input from '../components/Input'
import Botao from '../components/Botao'
import Alerta from '../components/Alerta'
import { useAuth } from '../context/AuthContext'
import { validarEmail, validarSenhaMinima } from '../utils/validacoes'
export default function Registrar(){ const { registrar } = useAuth(); const navegar = useNavigate(); const [nome,setNome]=useState(''); const [email,setEmail]=useState(''); const [senha,setSenha]=useState(''); const [confirmar,setConfirmar]=useState(''); const [erro,setErro]=useState(''); const [carregando,setCarregando]=useState(false); async function onSubmit(e){ e.preventDefault(); setErro(''); if(!nome) return setErro('Informe seu nome.'); if(!validarEmail(email)) return setErro('Informe um e-mail válido.'); if(!validarSenhaMinima(senha,6)) return setErro('A senha deve ter ao menos 6 caracteres.'); if(senha!==confirmar) return setErro('A confirmação de senha não confere.'); try{ setCarregando(true); await registrar({ nome,email,senha }); navegar('/dashboard'); }catch(ex){ setErro(ex?.response?.data?.mensagem || 'Não foi possível registrar.'); } finally{ setCarregando(false);} } return <div className="max-w-md mx-auto mt-10 card p-6"><h1 className="text-xl font-semibold mb-4">Criar conta</h1>{erro && <div className="mb-3"><Alerta tipo="erro" mensagem={erro} /></div>}<form onSubmit={onSubmit} className="space-y-3"><Input rotulo="Nome" placeholder="Seu nome" valor={nome} onChange={e=>setNome(e.target.value)} /><Input rotulo="E-mail" placeholder="seu@email" valor={email} onChange={e=>setEmail(e.target.value)} tipo="email" /><Input rotulo="Senha" placeholder="••••••" valor={senha} onChange={e=>setSenha(e.target.value)} tipo="password" /><Input rotulo="Confirmar senha" placeholder="••••••" valor={confirmar} onChange={e=>setConfirmar(e.target.value)} tipo="password" /><Botao type="submit" carregando={carregando}>Registrar</Botao></form><div className="text-sm mt-4 text-gray-600">Já tem conta? <Link to="/login" className="text-emerald-700 hover:underline">Entrar</Link></div></div> }

import React, { useEffect, useState } from 'react'
import api from '../services/api'
import GraficoPizza from '../components/GraficoPizza'
import GraficoBarra from '../components/GraficoBarra'
import { anoMesAtual } from '../utils/formatadores'
export default function Relatorios(){ const [mes,setMes]=useState(anoMesAtual()); const [periodo,setPeriodo]=useState(6); const [categorias,setCategorias]=useState([]); const [mensal,setMensal]=useState([]); const [erro,setErro]=useState(''); const [carregando,setCarregando]=useState(false); async function carregar(){ try{ setCarregando(true); setErro(''); const [c,m]=await Promise.all([api.relatorios.categorias(mes), api.relatorios.mensal(periodo)]); setCategorias(c.data||[]); setMensal(m.data||[]);}catch(ex){ setErro(ex?.response?.data?.mensagem || 'Falha ao carregar relatórios.'); } finally{ setCarregando(false);} } useEffect(()=>{carregar()},[mes,periodo]); return <div className="space-y-4"><h1 className="titulo-secao">Relatórios</h1>{erro && <div className="card p-4 text-sm text-red-600">{erro}</div>}<div className="card p-4 grid grid-cols-1 md:grid-cols-3 gap-3"><div><label className="block text-sm mb-1">Mês</label><input type="month" value={mes} onChange={e=>setMes(e.target.value)} className="w-full border rounded px-3 py-2" /></div><div><label className="block text-sm mb-1">Período</label><select value={periodo} onChange={e=>setPeriodo(Number(e.target.value))} className="w-full border rounded px-3 py-2"><option value={3}>Últimos 3 meses</option><option value={6}>Últimos 6 meses</option><option value={12}>Últimos 12 meses</option></select></div></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div><h2 className="titulo-secao mb-2">Despesas por categoria</h2>{carregando ? <div className="card p-6">Carregando...</div> : <GraficoPizza dados={categorias} chaveValor="valor" chaveNome="categoria" />}</div><div><h2 className="titulo-secao mb-2">Evolução mensal</h2>{carregando ? <div className="card p-6">Carregando...</div> : <GraficoBarra dados={mensal} />}</div></div></div> }

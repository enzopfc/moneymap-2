import React, { useEffect, useState } from 'react'
import CardResumo from '../components/CardResumo'
import GraficoBarra from '../components/GraficoBarra'
import api from '../services/api'
import { anoMesAtual, formatarMoedaBRL } from '../utils/formatadores'
import Alerta from '../components/Alerta'
export default function Dashboard(){ const [resumo,setResumo]=useState(null); const [mensal,setMensal]=useState([]); const [erro,setErro]=useState(''); const [carregando,setCarregando]=useState(true); async function carregar(){ try{ setCarregando(true); setErro(''); const mes=anoMesAtual(); const [r1,r2]=await Promise.all([api.relatorios.resumo(mes), api.relatorios.mensal(3)]); setResumo(r1.data); setMensal(r2.data||[]);}catch(ex){ setErro(ex?.response?.data?.mensagem || 'Falha ao carregar o dashboard.');} finally{ setCarregando(false);} } useEffect(()=>{carregar()},[]); return <div className="space-y-4"><h1 className="titulo-secao">Visão Geral</h1>{erro && <Alerta tipo="erro" mensagem={erro} /> }<div className="grid grid-cols-1 md:grid-cols-3 gap-4"><CardResumo titulo="Saldo" valor={formatarMoedaBRL(resumo?.saldo||0)} subtexto="acumulado" /><CardResumo titulo="Receitas (mês)" valor={formatarMoedaBRL(resumo?.receitasMes||0)} subtexto="este mês" cor="blue" /><CardResumo titulo="Despesas (mês)" valor={formatarMoedaBRL(resumo?.despesasMes||0)} subtexto="este mês" cor="red" /></div><div><h2 className="titulo-secao mb-2">Receitas x Despesas (mensal)</h2>{carregando ? <div className="card p-6">Carregando gráfico...</div> : <GraficoBarra dados={mensal} />}</div></div> }
